// Page content
$('#board-content').html('<%= j render(partial: "board_columns") %>');

// Scrollbars
$('.sento-kanban').perfectScrollbar();
$('.sento-kanban-column-body').perfectScrollbar();

// Drag'n drop
dragula($('.sento-kanban-cards').toArray(), {
  copySortSource: true
}).on('drop', function(element, target, source) {
  var boardId = $('#board-content').data('board-id'),
      targetColumnId = $(target).data('column-id'),
      sourceColumnId = $(source).data('column-id'),
      cardPosition = $(target).find('a.card-action-link').index($(element));

  $.ajax({
    url: '/boards/' + boardId + '/columns/' + sourceColumnId + '/cards/' + $(element).data('card-id'),
    method: 'PATCH',
    data: { card: { card_order_position : cardPosition, column_id: targetColumnId } }
  });
});

// Floating menu
$('*[data-behavior="close-floating-menu"]').on('click', function() {
  $('.floating-menu').addClass('hide');
});
$('*[data-behavior="open-floating-menu"]').on('click', function() {
  $('.floating-menu').removeClass('hide');
});
