$('#card-title').html('<%= j render(partial: "card_title_edit") %>');

var orginalTitleHtml = '<%= link_to edit_title_card_path(@card), class: "editable", remote: true do %><h4 class="modal-title"><%= j @card.title %></h4><% end %>',
    preventModalHide = true;

$('*[data-behavior="cancel-edit"]').on('click', function() {
  $('#card-title').html(orginalTitleHtml);
  preventModalHide = false;
});

$('#mainModal').on('hide.bs.modal', function(event) {
  if (preventModalHide) {
    event.preventDefault();
  }
});

// Select the first form field automatically
setTimeout(function() {
  var firstField = $("form:not(.filter) :input:visible:enabled:first");
  if (firstField.length > 0)
    firstField.get(0).focus();
}, 200);

$(document).keyup(function(event) {
  if (event.keyCode == 27) { // escape key
    if (preventModalHide) {
      $('#card-title').html(orginalTitleHtml);
      preventModalHide = false;
    } else {
      $('#mainModal').modal('hide');
    }
  }
});
